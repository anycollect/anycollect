extensions:
- !load
  extension: SelfDiscovery
  instance: self
  injectMode: auto
- !load
  extension: PullEngine
  instance: puller
  config:
    updatePeriod: 5
    pullPeriod: 3
    defaultPoolSize: 1
    rules:
    - targetId: "test"
      poolSize: 1
- !load
  extension: MeterRegistry
  instance: registry
  injectMode: auto
- !load
  extension: CurrentApp
  instance: discovery
  config:
    name: test
- !load
  extension: StaticJmxQueryProvider
  instance: queries
  config:
    queries:
    - key: histogram
      mbean: "test:name=Test,k1=*,k2=*"
      tagKeys: [k1, k2]
      unit: events
      tags:
        key1: value1
      meta:
        key2: value2
      whitelist:
        keys: [k1, k2]
        values:
        - [k1val2, k2val1]
      measurements:
        - { path: Min, type: gauge, stat: min }
        - { path: Max, type: gauge, stat: max }
        - { path: Mean, type: gauge, stat: mean }
        - { path: StdDev, type: gauge, stat: std }
        - { path: 50thPercentile, type: gauge, stat: max_50 }
        - { path: 75thPercentile, type: gauge, stat: max_75 }
        - { path: 90thPercentile, type: gauge, stat: max_90 }
        - { path: 95thPercentile, type: gauge, stat: max_95 }
        - { path: 99thPercentile, type: gauge, stat: max_99 }
- !load
  extension: StaticQueryMatcherResolver
  instance: matcher
  config:
    rules:
    - instanceId: "test"
      queryId: ".*"
      period: 10
- !load
  extension: JmxReader
  instance: jmx
  dependencies:
    puller: !ref puller
    discovery: !refs
    - discovery
    queries: !refs
    - queries
    matcher: !ref matcher